<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Processskapare</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="p-6 bg-gray-50">
  <div class="max-w-4xl mx-auto bg-white p-8 shadow-md rounded-lg">
    <h1 class="text-3xl font-bold mb-8 text-center text-blue-800">Processskapare</h1>

    <form id="processForm" class="space-y-12">
      
        <div class="section border-t-2 pt-6" id="section-A">
          <h2 class="text-2xl font-semibold mb-6">1 Typ av process</h2>

          
            <p class="text-gray-600 italic">Inga frågor tillgängliga för denna sektion.</p>
          
        </div>
      
        <div class="section border-t-2 pt-6" id="section-M">
          <h2 class="text-2xl font-semibold mb-6">2 Deltagare</h2>

          
            <p class="text-gray-600 italic">Inga frågor tillgängliga för denna sektion.</p>
          
        </div>
      
        <div class="section border-t-2 pt-6" id="section-N">
          <h2 class="text-2xl font-semibold mb-6">3 Förslag</h2>

          
            
              <div class="question-container mb-8">
                <h3 class="text-xl font-medium mb-4">Ska förslag leda till beslut?</h3>

                
                  <div class="answers-container space-y-3">
                    
                      <div class="answer flex items-start space-x-3">
                        <input type="radio"
                               name="question-O"
                               id="answer-O-0"
                               value="P"
                               class="mt-1">
                        <label for="answer-O-0" class="text-lg">
                          Nej, bara diskussion

                          
                            <span class="text-sm block mt-1 text-gray-600">
                              (→ Lägg till komponenten Debatt för att kunna sammanfatta diskussioner. Eller använd förslagskomponenten med kommentarer aktiverade.)
                            </span>
                          
                        </label>
                      </div>
                    
                  </div>
                
              </div>
            
          
        </div>
      
        <div class="section border-t-2 pt-6" id="section-DB">
          <h2 class="text-2xl font-semibold mb-6">5 Möten</h2>

          
            <p class="text-gray-600 italic">Inga frågor tillgängliga för denna sektion.</p>
          
        </div>
      

      <div class="pt-8 border-t-2">
        <button type="button" id="summarizeBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg shadow-md transition-colors">
          Sammanfatta dina val
        </button>
      </div>
    </form>

    <div id="summary" class="mt-8 hidden pt-8 border-t-2">
      <h2 class="text-2xl font-semibold mb-6">Sammanfattning av dina val</h2>
      <div id="summaryContent" class="bg-gray-50 p-6 rounded-lg">
        <!-- Innehåll genereras dynamiskt -->
      </div>

      <button id="downloadPDF" class="mt-6 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg shadow-md transition-colors">
        Ladda ner PDF
      </button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Hitta alla sektioner, frågor och svar
      const form = document.getElementById('processForm');
      const summarizeBtn = document.getElementById('summarizeBtn');
      const summaryDiv = document.getElementById('summary');
      const summaryContent = document.getElementById('summaryContent');
      const downloadPDFBtn = document.getElementById('downloadPDF');

      // När användaren klickar på "Sammanfatta"
      summarizeBtn.addEventListener('click', function() {
        // Samla ihop valda alternativ
        const selectedAnswers = [];
        const radioInputs = form.querySelectorAll('input[type="radio"]:checked');
        const checkboxInputs = form.querySelectorAll('input[type="checkbox"]:checked');

        // Funktion för att extrahera information
        function extractAnswerInfo(input) {
          const questionContainer = input.closest('.question-container');
          if (!questionContainer) return null;

          const questionText = questionContainer.querySelector('h3').textContent;
          const label = input.nextElementSibling;
          if (!label) return null;

          // Hämta svarstext (allt före eventuell rekommendation i parentes)
          let answerText = label.textContent.trim();
          const spanElement = label.querySelector('span');
          if (spanElement) {
            answerText = answerText.replace(spanElement.textContent, '').trim();
          }

          // Hämta rekommendation om den finns
          const recommendationElement = label.querySelector('span');
          let recommendationText = null;
          if (recommendationElement) {
            recommendationText = recommendationElement.textContent.replace(/\(→\s*|\)/g, '').trim();
          }

          return {
            question: questionText,
            answer: answerText,
            recommendation: recommendationText
          };
        }

        // Samla radioknappar
        radioInputs.forEach(input => {
          const info = extractAnswerInfo(input);
          if (info) selectedAnswers.push(info);
        });

        // Samla checkboxar
        checkboxInputs.forEach(input => {
          const info = extractAnswerInfo(input);
          if (info) selectedAnswers.push(info);
        });

        // Visa sammanfattningen
        summaryContent.innerHTML = '';

        if (selectedAnswers.length === 0) {
          summaryContent.innerHTML = '<p class="text-red-600">Inga val har gjorts. Vänligen välj alternativ i formuläret.</p>';
        } else {
          // Gruppera efter fråga
          const groupedAnswers = {};
          selectedAnswers.forEach(item => {
            if (!groupedAnswers[item.question]) {
              groupedAnswers[item.question] = [];
            }
            groupedAnswers[item.question].push(item);
          });

          // Skapa HTML
          Object.keys(groupedAnswers).forEach(question => {
            const answersHtml = groupedAnswers[question]
              .map(item => {
                let html = `<li class="mb-2">${item.answer}`;
                if (item.recommendation) {
                  html += `<div class="text-green-700 ml-4 mt-1">${item.recommendation}</div>`;
                }
                html += '</li>';
                return html;
              })
              .join('');

            summaryContent.innerHTML += `
              <div class="mb-6">
                <h3 class="font-semibold text-lg mb-2">${question}</h3>
                <ul class="list-disc pl-6">
                  ${answersHtml}
                </ul>
              </div>
            `;
          });
        }

        // Visa sammanfattningsdelen
        summaryDiv.classList.remove('hidden');

        // Scrolla till sammanfattningen
        summaryDiv.scrollIntoView({ behavior: 'smooth' });
      });

      // När användaren klickar på "Ladda ner PDF"
      downloadPDFBtn.addEventListener('click', function() {
        // Se till att jsPDF är laddat
        if (typeof window.jspdf === 'undefined') {
          alert('PDF-biblioteket kunde inte laddas. Försök igen senare.');
          return;
        }

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Titel
        doc.setFontSize(18);
        doc.text("Sammanfattning av process", 20, 20);

        // Innehåll
        doc.setFontSize(12);
        let yPos = 40;

        // Hämta sektioner från sammanfattningen
        const sections = summaryContent.querySelectorAll('div.mb-6');

        sections.forEach(section => {
          const title = section.querySelector('h3').textContent;
          doc.setFont(undefined, 'bold');
          doc.text(title, 20, yPos);
          doc.setFont(undefined, 'normal');
          yPos += 10;

          // Hämta svar
          const items = section.querySelectorAll('li');
          items.forEach(item => {
            // Svarstext
            const answerText = item.childNodes[0].textContent;
            doc.text("• " + answerText, 25, yPos);
            yPos += 7;

            // Eventuell rekommendation
            const recommendation = item.querySelector('div');
            if (recommendation) {
              doc.setTextColor(0, 100, 0); // Grön text för rekommendationer
              doc.text("  → " + recommendation.textContent, 30, yPos);
              doc.setTextColor(0, 0, 0); // Återställ textfärg
              yPos += 7;
            }

            // Kontrollera om vi behöver ny sida
            if (yPos > 270) {
              doc.addPage();
              yPos = 20;
            }
          });

          yPos += 10;
        });

        // Spara PDF
        doc.save('process-sammanfattning.pdf');
      });
    });
  </script>
</body>
</html>
